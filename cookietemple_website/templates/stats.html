<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Cookietemple</title>
    <meta name="description" content="The cookietemple Website">
    <meta name="author" content="Philipp Ehmele">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="../static/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/assets/css/code_highlighting/github.css" rel="stylesheet">
    <link href="../static/assets/css/leaflet.css" rel="stylesheet">
    <link href="../static/assets/css/Chart.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/471b59d3f8.js"></script>
    <!-- Other JS -->
    <script src="../static/assets/js/jquery-3.4.1.min.js"></script>
    <script src="../static/assets/js/popper.min.js"></script>
    <script src="../static/assets/js/bootstrap.min.js"></script>
    <script src="../static/assets/js/highlight.pack.js"></script>
    <script src="../static/assets/js/leaflet.js"></script>
    <!-- Page-specific CSS and JS -->
    <script src="../static/assets/js/moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="../static/assets/js/hammer.min.js"></script>
    <script src="../static/assets/js/chartjs-plugin-zoom.min.js"></script>
    <script src="../static/assets/js/canvas2svg.js"></script>
    <script src="../static/assets/js/FileSaver.js"></script>
    <link href="../static/assets/css/jquery-ui.min.css" rel="stylesheet">
    <script src="../static/assets/js/jquery-ui.min.js"></script>
    <script src="../static/assets/js/moment.js"></script>
    <script src="../static/assets/js/showdown.min.js"></script>
    <script src="../static/assets/js/jquery.tablesorter.min.js"></script>

    <!-- Custom cookietemple CSS and JS -->
    <link href="../static/assets/css/cookietemple.css" rel="stylesheet">
    <link href="../static/assets/css/cookietemple-dark.css" rel="stylesheet" id="theme-stylesheet">
    <script src="../static/assets/js/cookietemple.js"></script>
    <script>window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-68098153-2'); </script>
</head>
<body>

<nav class="navbar fixed-top navbar-expand-md navbar-light site-nav">
    {% include 'header.html' %}
</nav>
<div class="mainpage">
    <div class="mainpage-heading">
        <div class="container">
            <h1 class="display-3">Statistics</h1>
            <p class="lead">Get detailed insights into cookietemple</p></div>
    </div>

    <div class="triangle triangle-down"></div>

    <div class="container main-content">
        <h1 id="community"><a href="#" class="header-link"><span class="fas fa-link" aria-hidden="true"></span></a>Community</h1>
        <p>The numbers below track the growth of cookietemple over time.</p>
        <p class="text-info small">
            <i class="far fa-hand-point-right"></i>
            Click a number to see how the community has grown over time
        </p>

        <div class="card-group text-center stats_keynumbers">
            <div class="card bg-light">
                <div class="card-body">
                    <p class="card-text display-4"><a href="#" class="text-body text-decoration-none stretched-link">3</a></p>
                    <p class="card-text text-muted">Discord users</p>
                </div>
                <div class="bg-icon"><i class="fab fa-discord"></i></div>
            </div>
            <div class="card bg-light">
                <div class="card-body">
                    <p class="card-text display-4"><a href="#" class="text-body text-decoration-none stretched-link">2</a></p>
                    <p class="card-text text-muted">GitHub organisation members</p>
                </div>
                <div class="bg-icon"><i class="fab fa-github"></i></div>
            </div>
            <div class="card bg-light">
                <div class="card-body" data-toggle="tooltip">
                    <p class="card-text display-4"><a href="#" class="text-body text-decoration-none stretched-link">7</a></p>
                    <p class="card-text text-muted">GitHub contributors</p>
                </div>
                <div class="bg-icon"><i class="fas fa-code-branch"></i></div>
            </div>
            <div class="card bg-light">
                <div class="card-body">
                    <p class="card-text display-4"><a href="#" class="text-body text-decoration-none stretched-link">2</a></p>
                    <p class="card-text text-muted">Twitter followers</p>
                </div>
                <div class="bg-icon"><i class="fab fa-twitter"></i></div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <h2 class="mt-0" id="commits"><a href="#commits" class="header-link"><span class="fas fa-link" aria-hidden="true"></span></a>Commits</h2>
                <p>The chart below, shows the commits made to cookietemple over time. Initially, we started developing cookietemple
                    at the start of 2020.</p>
                <div class="card bg-light mt-4">
                    <div class="card-body">
                        <canvas id="ct_commits" height="200"></canvas>
                        <p class="card-text small text-muted mt-3 mb-1"><i class="fas fa-info-circle"></i> Data updated every 24 hours at 2:30AM.</p>
                        <p class="card-text small text-muted mb-1"><i class="fas fa-exclamation-triangle"></i> This only includes commits to the main branch!
                        </p>
                        <p class="card-text small text-muted">
                            <a href="#" data-target="" class="dl_plot_svg text-muted"><i class="fas fa-download"></i> SVGDownNotWork</a>
                            <a href="#" data-target="commits" class="reset_chart_zoom text-muted"><i class="fas fa-search-minus"></i> Reset zoom</a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <h2 class="mt-0" id="prs"><a href="#prs" class="header-link"><span class="fas fa-link" aria-hidden="true"></span></a>Pull requests</h2>
                <p>This chart shows the closed Github Pull requests over time and the open PRs on that day. Over the time, many new features were added to cookietemple
                through these Pull requests.</p>
                <div class="card bg-light mt-4">
                    <div class="card-body">
                        <canvas id="pull_requests" height="200"></canvas>
                        <p class="card-text small text-muted mt-3 mb-1"><i class="fas fa-info-circle"></i> Data updated every 24 hours at 2:30AM.</p>
                        <p class="card-text small text-muted mb-1"><i class="fas fa-exclamation-triangle"></i> This only includes PRs to the default development branch!
                        </p>
                        <p class="card-text small text-muted">
                            <a href="#" data-target="" class="dl_plot_svg text-muted"><i class="fas fa-download"></i> SVGDownNotWork</a>
                            <a href="#" data-target="pull_requests" class="reset_chart_zoom text-muted"><i class="fas fa-search-minus"></i> Reset zoom</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            /*
            Parse commit data
             */
            const commit_statistics = JSON.parse('{{ commits_data|safe }}');
            dates_of_commits = []
            number_of_commits = []
            for (commit_date in commit_statistics) {
                dates_of_commits.push(commit_date)
                number_of_commits.push(commit_statistics[commit_date])
            }
            /*
            Parse open PR data
             */
            const open_pr_statistics = JSON.parse('{{ open_pr_data|safe }}');
            let open_pr_data = []
            for (open_pr in open_pr_statistics) {
                let data = {x:open_pr, y:open_pr_statistics[open_pr]}
                open_pr_data.push(data)
            }
            /*
            Parse closed PR data
             */
            const closed_pr_statistics = JSON.parse('{{ closed_pr_data|safe }}');
            let closed_pr_data = []
            for (closed_pr in closed_pr_statistics) {
                let data = {x:closed_pr, y:closed_pr_statistics[closed_pr]}
                closed_pr_data.push(data)
            }
            console.log(open_pr_data)
            console.log("=======================")
            console.log(closed_pr_data)
        </script>

        <script>
            // Placeholder for chart data
            var chartData = {};
            var charts = {};

            // Chart.JS base config
            var chartjs_base = {
                type: 'line',
                fill: 'origin',
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        fontSize: 16
                    },
                    tooltips: {
                        mode: 'x'
                    },
                    plugins: {
                        zoom: {
                            zoom: {
                                enabled: true,
                                drag: true,
                                mode: 'x',
                                speed: 0.05
                            }
                        }
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    elements: {
                        line: {
                            borderWidth: 1,
                            tension: 0
                        }
                    },
                    scales: {
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true
                            }
                        }],
                        xAxes: [{
                            type: 'time',
                            time: {minUnit: 'year'}
                        }],
                    },
                    legend: {
                        display: false
                    }

                }
            };

            chartData['commits'] = JSON.parse(JSON.stringify(chartjs_base));
            chartData['commits'].data = {
                labels: dates_of_commits,
                datasets: [
                    {
                        label: 'Commits to cookietemple',
                        borderColor: '#005fff',
                        pointRadius: 0,
                        data: number_of_commits,
                        fill: true,
                    }
                ]
            };
            chartData['commits'].options.title.text = 'Commits to cookietemple';
            chartData['commits'].options.legend = {
                position: 'bottom',
                labels: {lineWidth: 1}
            };
            var ctx = document.getElementById('ct_commits').getContext('2d');
            charts['commits'] = new Chart(ctx, chartData['commits']);

            chartData['pull_requests'] = JSON.parse(JSON.stringify(chartjs_base));
            chartData['pull_requests'].data = {
                datasets: [
                    {
                        label: 'Open PRs',
                        borderColor: '#00ff00',
                        pointRadius: 0,
                        data: open_pr_data,
                        fill: 'origin'
                    },
                    {
                        label: 'Closed PRs',
                        borderColor: '#ff0000',
                        pointRadius: 0,
                        data: closed_pr_data,
                    }
                ]
            };
            chartData['pull_requests'].options.title.text = 'GitHub PRs over time';
            chartData['pull_requests'].options.scales.yAxes = [{stacked: true}];
            //chartData['pull_requests'].options.elements.line.fill = '-1';
            chartData['pull_requests'].options.legend = {
                position: 'bottom',
                labels: {lineWidth: 1}
            };
            var ctx = document.getElementById('pull_requests').getContext('2d');
            charts['pull_requests'] = new Chart(ctx, chartData['pull_requests']);


            // reset zoom for plots
            $('.reset_chart_zoom').click(function (e) {
                e.preventDefault();
                var target = $(this).data('target');
                charts[target].resetZoom()
            });
        </script>
    </div>
</div>
<footer class="footer">
    {% include 'footer.html' %}
</footer>
</body>
</html>
